{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "cumulus-message",
  "description": "A cumulus SNS Message to trigger or respond to processing. The current schema only allows for a bucket to be identified OR for a single granule to be identified.",
  "type": "object",
  "properties": {
    "ingestTime": {
      "description": "Time ingestion was attempted by ingest system",
      "type":"string"
    },
    "deliveryTime": {
      "description": "Time message was sent to ingest system",
      "type":"string"
    },
    "identifier": {
      "description":"Unique identifier for the message as a whole. It is usally the senders responsibility to ensure uniqueness. This identifier can be used in response messages to provide tracability.",
      "type":"string"
    },
    "collection": {
      "description": "The collection for which these granules will belong. Could be the same as URS or some other identifier.",
      "type": "string"
    },
    "provider": {
      "description": "the name of the provider producing these files. This is informational only and is not used by the cumulus framework",
      "type": "string"
    },
    "bucket": {
      "description": "location of the s3 bucket to ingest from.",
      "type": "string"
    },
    "response":{
      "description": "The response message type sent. Can be a success message or error message. Akin to both the PAN and PDRD",
      "type": "object",
      "properties": {
        "status":{
          "description":"Successful or error.",
          "type":"string",
          "enum": [
            "SUCCESS",
            "FAILURE"
          ]
        },
        "errorCode": {
          "description":"Error message. Success messages can be ignored.",
          "type":"string",
          "enum": [
            "INGEST_ERROR",
            "ARCHIVE_ERROR",
            "UNKNOWN_ERROR",
            "OTHER"
          ]
        },
        "errorMessage":{
          "description":"The message error for the failure that occured.",
          "type":"string"
        }
      },
      "required": [
          "status"
      ]
    },
    "granule": {
      "type": "object",
      "properties": {
        "granuleName": {
          "description": "Identifier/name of the granule",
          "type": "string"
        },
        "dataVersion": {
          "description": "Version of this granule ",
          "type": "string"
        },
        "files": {
          "description": "array of files that make up this granule",
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "fileType": {
                "description": "The type of file. science files (netcdf, HDF, binary) should use the 'data' type. More can be added if need and consensus demand.",
                "type": "string",
                "enum": [
                  "data",
                  "browse",
                  "metadata"
                ]
              },
              "key": {
                "description": "bucket +  key = file location",
                "type": "string"
              },
              "checksumType": {
                "description": "Type of the checksum (e.g. md5). Optional. If no checksumType is defined for a file, it is assumed to be md5",
                "type": "string"
              },
              "checksum": {
                "description": "Checksum of the file.",
                "type": "string"
              },
              "fileSize": {
                "description": "Size, in bytes, of the file.",
                "type": "number"
              }
            },
            "required": [
              "fileType",
              "key",
              "fileSize"
              "checksum"
            ]
          }
        }
      },
      "required": [
        "granuleName",
        "dataVersion",
        "files"
      ]
    }
  },
  "oneOf": [
    {"required": ["deliveryTime","collection", "identifier", "bucket"]},
    {"required": ["ingestTime","deliveryTime","collection", "response"] }
  ]
}
